<section class="card narrow">
  <h2>Impor Data Santri dari Excel (.xlsx)</h2>
  <p class="hint">Sistem membaca sheet pertama (Sheet1) secara otomatis dan memetakan kolom: NIS, Nama, Kelas, Kelompok, Tanggal Lahir, Alamat, HP Wali.</p>
  <form method="POST" action="/santri/import/excel/preview?_csrf=<%= csrfToken %>" class="form-grid" enctype="multipart/form-data">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
    <label>File Excel (.xlsx)
      <input type="file" name="excel" accept=".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" required />
    </label>
    <button type="submit" class="btn">Preview</button>
  </form>

  <% if (preview && preview.rows) { %>
  <div class="card" style="margin-top:12px;">
    <h3>Preview (<%= preview.rows.length %> baris contoh)</h3>
    <table class="table" style="margin-top:8px;">
      <thead>
        <tr>
          <th>NIS</th>
          <th>Nama</th>
          <th>Kelas</th>
          <th>Kelompok</th>
          <th>Tanggal Lahir</th>
          <th>Alamat</th>
          <th>HP Wali</th>
        </tr>
      </thead>
      <tbody>
        <% preview.rows.forEach(r => { %>
          <tr>
            <td><%= r.nis || '' %></td>
            <td><%= r.nama || '' %></td>
            <td><%= r.kelas || '' %></td>
            <td><%= r.kelompok || '' %></td>
            <td><%= r.tgl_lahir || '' %></td>
            <td><%= r.alamat || '' %></td>
            <td><%= r.hp_wali || '' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
    <form method="POST" action="/santri/import/excel/run?_csrf=<%= csrfToken %>" class="form-grid" enctype="multipart/form-data" style="margin-top:8px;">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <label>File Excel (.xlsx)
        <input type="file" name="excel" accept=".xlsx,.xls,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" required />
      </label>
      <button type="submit" class="btn-primary">Impor Semua</button>
    </form>
  </div>
  <% } %>
</section>